<%= content_for :course do %>
  <ul class="sidebar-list">
    <li>
      <%= link_to information_owner_course_path(@course) do %>
        <i class="font-medium fa-solid fa-greater-than"></i>課程內容
      <% end %>
    </li>
    <li>
      <%= link_to curriculum_owner_course_path(@course) do %>
        <i class="font-medium fa-solid fa-greater-than"></i>章節內容
      <% end %>
    </li>
    <li>
      <%= link_to comments_owner_course_path(@course) do %>
        <i class="font-medium fa-solid fa-greater-than"></i>留言管理
      <% end %>
    </li>
  </ul>
<% end %>

<div class="owner-main-container relative pt-10 min-h-screen">
  <div class="w-11/12 mx-auto">
		<div class="flex items-center w-full h-16 mt-4">
			<h1 class="inline-block my-4 text-4xl font-extrabold text-primary-300">課程留言</h1>
			<div class="w-1/3 mx-4 mr-auto">
				<%= render "shared/flash" %>
			</div>
		</div>
		<table class="mt-6 overflow-hidden rounded-md owner-table shadow-md comment-table">
			<thead class="owner-thead">
				<tr>
					<th class="text-left owner-text">留言</th>
					<th class="text-center owner-text">留言者</th>
					<th class="text-center owner-text">章節/小節</th>
					<th class="text-center owner-text">即時回覆</th>
				</tr>
			</thead>
			<tbody class="owner-tbody" data-controller="comments">
				<% Comment.where(course_id: @course.id).includes(:section, :user).order(id: :desc).each do |comment| %>
					<tr class="hover:bg-primary-200 transition">
						<td class="text-left owner-text text-primary-500">
							<span class="w-44 whitespace-nowrap overflow-ellipsis overflow-hidden">
								<%= comment.content %>
							</span>
						</td>
						<td class="text-center owner-text text-primary-500 whitespace-nowrap">
							<%= comment.user.username %>
						</td>
						<td class="text-center owner-text text-primary-500 whitespace-nowrap">
							<%= comment.section.chapter.title %> / <%= comment.section.title %>
						</td>
						<td class="flex items-center px-8">
							<button class="tag tag-safe mr-auto" data-action="click->comments#toggle">回覆</button>
							<%= link_to "#", method: "delete", data: { confirm: "確定刪除此留言嗎？" }, class: "block p-2 text-red-400 hover:text-red-600" do %>
								<svg xmlns="http://www.w3./2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
								</svg>
							<% end %>
						</td>
					</tr>
					<tr class="hidden" data-comments-target="commentForm">
						<td>
							<%= form_with(url: owner_course_section_comments_path(@course, comment.section), scope: "comment") do |form|%>
								<input type="hidden" name=comment[parent_id] value="<%= comment.id %>">
								<%= form.text_area :content, class:"" %>
								<%= form.submit "送出", data: { action: "click->comments#send" } %>
							<% end %>
						</td>
					</tr>
				<% end %>
			</tbody>
		</table>
	</div>
</div>
